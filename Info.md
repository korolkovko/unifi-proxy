

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: Unifi Firmware Proxy Gateway                                                                                   1

# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: Unifi Firmware Proxy Gateway

<table>
<tr>
<td>–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞</td>
<td>1.0</td>
</tr>
<tr>
<td>–î–∞—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞</td>
<td>05.11.2025</td>
</tr>
</table>

**–¶–µ–ª—å:** –æ–±—Ö–æ–¥ –≥–µ–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ Ubiquiti (fw-download, fw-update, apt.*) —á–µ—Ä–µ–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π VPS —Å NGINX TLS passthrough.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** UniFi OS, –≤–∫–ª—é—á–∞—è Network / Protect / Access / –ø—Ä–æ—á–µ–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —Å Amazon CloudFront.

> üí¨ **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ—Ç –∞–≤—Ç–æ—Ä–∞ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞**
> 
> –î–æ –ø—Ä–æ—á—Ç–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ —Ö–æ—á—É —É—Ç–æ—á–Ω–∏—Ç—å:
> –†–∞–∑–º–µ—â–∞—è –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–∞ —Ñ–æ—Ä—É–º–µ, —è –Ω–µ –ø–∏—à—É –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∂—É—Ä–Ω–∞–ª –∏ –Ω–µ –ø—ã—Ç–∞—é—Å—å –±–ª–µ—Å–Ω—É—Ç—å –∑–Ω–∞–Ω–∏—è–º–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã—Ö –æ–±–ª–∞—Å—Ç—è—Ö.
> –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Ä–µ—à–∏—Ç –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–ª–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚Äî –º–Ω–µ –≤—Å—ë —Ä–∞–≤–Ω–æ.
> –Ø –¥–µ–ª—é—Å—å —Å–≤–æ–∏–º –æ–ø—ã—Ç–æ–º, —á—Ç–æ–±—ã –≤—ã –Ω–µ —Ç–∞–Ω—Ü–µ–≤–∞–ª–∏ —Å –±—É–±–Ω–æ–º, –∫–∞–∫ —ç—Ç–æ —á–∞—Å—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Unifi.
> –ï—Å–ª–∏ —Å—Ä–µ–¥–∏ —á–∏—Ç–∞—é—â–∏—Ö –æ–∫–∞–∂—É—Ç—Å—è –æ–ø—ã—Ç–Ω—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã ‚Äî –æ–Ω–∏ –∏ –±–µ–∑ –º–µ–Ω—è —Ä–∞–∑–±–µ—Ä—É—Ç—Å—è, –≥–¥–µ –∏ –∫–∞–∫ —É–¥–æ–±–Ω–µ–µ —Å–¥–µ–ª–∞—Ç—å.
> –ê –µ—Å–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª –ø—Ä–æ—á–∏—Ç–∞–µ—Ç –Ω–æ–≤–∏—á–æ–∫ ‚Äî –Ø —É–≤–µ—Ä–µ–Ω, –æ–Ω –Ω–∞–π–¥—ë—Ç –∑–¥–µ—Å—å –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

## 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

<table>
    <tr>
        <td>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</td>
<td>–ú–∏–Ω–∏–º—É–º</td>
<td>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</td>
    </tr>
<tr>
        <td>VPS</td>
<td>Ubuntu 20.04  –∏–ª–∏ Debian 11</td>
<td>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ï–≤—Ä–æ–ø–∞  –§—Ä–∞–Ω—Ü–∏—è, –ì–µ—Ä–º–∞–Ω–∏—è, –ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã)</td>
    </tr>
<tr>
        <td>–î–æ—Å—Ç—É–ø</td>
<td>root –∏–ª–∏ sudo</td>
<td></td>
    </tr>
<tr>
        <td>UniFi Network</td>
<td>9.4.19</td>
<td>DNS Policy Engine –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç A –∑–∞–ø–∏—Å–∏
<br/>
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏ –≤ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–µ–π –≤–µ—Ä—Å–∏–∏ UniFi Network, –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ –æ—Ç–ª–∏—á–∏—è –≤ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–∏
<br/>
–Ω–∞—Å—Ç—Ä–æ–µ–∫)</td>
    </tr>
<tr>
        <td>–û—Ç–∫—Ä—ã—Ç—ã–π –ø–æ—Ä—Ç</td>
<td>TCP 443</td>
<td>–ù–µ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è OpenVPN –∏–ª–∏ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–æ–º</td>
    </tr>
</table>

## 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ NGINX –Ω–∞ VPS

### 2.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞:

```
sudo apt update
sudo apt install -y nginx
```

–ü—Ä–æ–≤–µ—Ä–∏–º –ø–æ–¥–¥–µ—Ä–∂–∫—É stream-–º–æ–¥—É–ª—è:

```
nginx -V 2>&1 | grep -o -- '--with-stream[_a-z-]*'
```

–ï—Å–ª–∏ –≤ –≤—ã–≤–æ–¥–µ –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏:

```
--with-stream
--with-stream_realip_module
--with-stream_ssl_module
--with-stream_ssl_preread_module
```

–í—Å—ë –≥–æ—Ç–æ–≤–æ (TLS passthrough –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é), –¥–≤–∏–≥–∞–µ–º—Å—è –¥–∞–ª—å—à–µ.

### 2.2 –î–æ–±–∞–≤–ª—è–µ–º stream-–∫–æ–Ω—Ñ–∏–≥–∏

> üí° –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Midnight Commander, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–º–∞–Ω–¥–æ–π apt install mc -y

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é NGINX, —Ñ–∞–π–ª /etc/nginx/nginx.conf —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥–æ–π:

```
sudo tee /etc/nginx/nginx.conf >/dev/null <<'EOF'
user nginx;
worker_processes auto;

error_log /var/log/nginx/error.log notice;
pid     /run/nginx.pid;

events {
      worker_connections 1024;
}

# –û—Ç–∫–ª—é—á–∞–µ–º HTTP, –Ω–µ –Ω—É–∂–µ–Ω
# http {
#     include      /etc/nginx/mime.types;
#     default_type application/octet-stream;
#     access_log   /var/log/nginx/access.log;
#     sendfile     on;
#     keepalive_timeout 65;
# }

# –í–∫–ª—é—á–∞–µ–º stream-–ø—Ä–æ–∫—Å–∏
include /etc/nginx/stream.conf.d/*.conf;
EOF
```

---



–°–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–∞–ª–æ–≥:

```
sudo mkdir -p /etc/nginx/stream.conf.d
```

## 2.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Unifi Firmware Proxy

–í–≤–æ–¥–∏–º –∫–æ–º–∞–Ω–¥—É `sudo mcedit /etc/nginx/stream.conf.d/unifi-firmware-proxy.conf`, –≤—Å—Ç–∞–≤–ª—è–µ–º —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:

> ‚ùó –í —Å—Ç—Ä–æ–∫–µ allow WAN_IP –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–µ–Ω–∏—Ç—å WAN_IP –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –≤–Ω–µ—à–Ω–∏–π IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ –∏–ª–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ UniFi –±—É–¥—É—Ç –æ–±—Ä–∞—â–∞—Ç—Å—è –∫ VPS.

```
stream {
 # DNS —Ä–µ–∑–æ–ª–≤–µ—Ä—ã –¥–ª—è stream-–ø—Ä–æ–∫—Å–∏
 resolver 1.1.1.1 8.8.8.8 valid=300 ipv6=off;

 # (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SNI –≤ stream
 log_format sni '$remote_addr:$remote_port ‚Üí $ssl_preread_server_name ($protocol)';
 access_log /var/log/nginx/stream_access.log sni;

 # –í—ã–±–æ—Ä –∞–ø—Å—Ç—Ä–∏–º–∞ –ø–æ SNI; –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –≤ "—á—ë—Ä–Ω—É—é –¥—ã—Ä—É"
 map $ssl_preread_server_name $ubnt_upstream {
  fw-download.ubnt.com             "fw-download.ubnt.com:443";
  fw-update.ubnt.com               "fw-update.ubnt.com:443";
  fw-update.ui.com                 "fw-update.ui.com:443";
  apt.artifacts.ui.com             "apt.artifacts.ui.com:443";
  apt-beta.artifacts.ui.com        "apt-beta.artifacts.ui.com:443";
  apt-release-candidate.artifacts.ui.com "apt-release-candidate.artifacts.ui.com:443";
  default                          "127.0.0.1:9";
 }

 server {
  listen 443;
  # –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –≤–Ω–µ—à–Ω–∏–π IP
  allow WAN_IP;
  deny all;

  ssl_preread on;
  preread_timeout 10s;

  proxy_pass $ubnt_upstream;
  proxy_ssl_server_name on;
  proxy_connect_timeout 10s;
  proxy_timeout 300s;
 }
}
```

–û—Ç–¥–µ–ª—å–Ω–æ —Ä–∞—Å–ø–∏—à—É –ø—Ä–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–ª–æ–∫–∞ `server { ... }`:

> üí° **server { ... }:**
> 
> **listen 443;**
> –£–∫–∞–∑—ã–≤–∞–µ—Ç NGINX —Å–ª—É—à–∞—Ç—å –ø–æ—Ä—Ç 443 (TCP).
> –ù–∞ –Ω–µ–≥–æ –ø—Ä–∏—Ö–æ–¥—è—Ç HTTPS-–∑–∞–ø—Ä–æ—Å—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (fw-download.ubnt.com, fw-update.ubnt.com –∏ —Ç.–¥.).
> 
> **allow WAN_IP;**
> –†–∞–∑—Ä–µ—à–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å —Ç–≤–æ–µ–≥–æ –≤–Ω–µ—à–Ω–µ–≥–æ IP (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–º–∞—à–Ω–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ UniFi). NGINX –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ IP, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ—Ä—Ç 443 –æ—Ç–∫—Ä—ã—Ç –≤ —Å–∏—Å—Ç–µ–º–µ.
> 
> **deny all;**
> –ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ—Ö, –∫—Ç–æ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –ø–æ–¥ allow. –í –ø–∞—Ä–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–æ–∫–æ–π –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ –∑–∞–∫—Ä—ã—Ç—ã–º –Ω–∞—Ä—É–∂—É, –∑–∞—â–∏—â–∞–µ—Ç VPS –æ—Ç —á—É–∂–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
> 
> **ssl_preread on;**
> –ö–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è SNI-–∏–Ω—Å–ø–µ–∫—Ü–∏–∏ –±–µ–∑ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ TLS. NGINX –≤–∏–¥–∏—Ç, –∫ –∫–∞–∫–æ–º—É –¥–æ–º–µ–Ω—É –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è (fw-update.ubnt.com –∏ —Ç.–¥.), –∏ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —ç—Ç–æ–≥–æ –≤—ã–±–∏—Ä–∞–µ—Ç –∞–ø—Å—Ç—Ä–∏–º (proxy_pass $ubnt_upstream;). NGINX –Ω–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç HTTPS, –∞ –ø—Ä–æ—Å—Ç–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –Ω–∞ –Ω—É–∂–Ω—ã–π upstream.
> 
> **preread_timeout 10s;**
> –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –Ω–∞—á–∞–ª–∞ TLS-—Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è (ClientHello).
> –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø—Ä–∏—Å–ª–∞–ª –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞ (SNI) –∑–∞ 10 —Å–µ–∫—É–Ω–¥, —Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è.
> 
> **proxy_pass $ubnt_upstream;**
> –ü–µ—Ä–µ–¥–∞—ë—Ç TCP-—Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π upstream (–∏–∑ map $ssl_preread_server_name).
> –ù–∞–ø—Ä–∏–º–µ—Ä:
> 
> * fw-update.ubnt.com ‚Üí fw-update.ubnt.com:443
> * fw-update.ui.com ‚Üí fw-update.ui.com:443
> * default ‚Üí 127.0.0.1:9 (—á—ë—Ä–Ω–∞—è –¥—ã—Ä–∞, –µ—Å–ª–∏ SNI –Ω–µ —Å–æ–≤–ø–∞–ª).
> 
> **proxy_ssl_server_name on;**
> –í–∫–ª—é—á–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É SNI –ø—Ä–∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–∏ (–∏–Ω–∞—á–µ backend –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–≤–µ—Ç–∏—Ç—å).
> –≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã Cloudflare/AWS –≤–∏–¥–µ–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞.
> 
> **proxy_connect_timeout 10s;**
> –õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å upstream.
> 
> **proxy_timeout 300s;**
> –û–±—â–µ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚Äî 300 —Å–µ–∫—É–Ω–¥ (~5 –º–∏–Ω—É—Ç). –ï—Å–ª–∏ –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, —Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è.

## 2.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: Unifi Firmware Proxy Gateway                                                                                                                      2


---



```
sudo nginx -t
sudo systemctl start nginx
sudo systemctl enable nginx
sudo systemctl status nginx --no-pager
```

–£–±–µ–¥–∏–º—Å—è, —á—Ç–æ NGINX —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 443:

```
sudo ss -ltnp | grep ':443'
```

–í—ã–≤–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:

```
LISTEN    0    xxx         0.0.0.0:443      0.0.0.0:*    users:(("nginx",pid=xxxx,fd=x),("nginx",pid=xxxx,fd=x))
```

## 2.5 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–∫—Å–∏ –∏–∑ –¥–æ–º–∞—à–Ω–µ–π —Å–µ—Ç–∏

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å —Å macOS, –ø–æ—ç—Ç–æ–º—É –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∏–∑-–ø–æ–¥ "—è–±–ª–æ—á–Ω–æ–π" –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã:

> ‚ùó –û–±—Ä–∞—â–∞—é –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤–º–µ—Å—Ç–æ VPS_IP –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–π VPS, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø—É—â–µ–Ω NGINX-–ø—Ä–æ–∫—Å–∏.

```
curl -I --resolve fw-download.ubnt.com:443:VPS_IP https://fw-download.ubnt.com/
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:

```
HTTP/2 403
x-amz-cf-pop: FRAxx
server: cloudflare
via: 1.1 cloudfront.net
```

–û—Ç–≤–µ—Ç 403 ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ (–¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ä–Ω—é –±–∞–∫–µ—Ç–∞ S3 –∑–∞–ø—Ä–µ—â—ë–Ω).

–ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–µ—Ç –æ—à–∏–±–∫–∏ SSL, –∏ –≤ –æ—Ç–≤–µ—Ç–µ –≤–∏–¥–Ω–æ CloudFront / FRAxx.

> üìñ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –Ω–∞ Linux, macOS –∏ Windows (—á–µ—Ä–µ–∑ PowerShell –∏–ª–∏ WSL), –Ω–æ –µ—Å—Ç—å –Ω—é–∞–Ω—Å—ã:

**Linux –∏ macOS**
–ö–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
curl –≤ —ç—Ç–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏–∑ –ø–∞–∫–µ—Ç–∞ cURL, –æ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ --resolve.

**Windows**

1. **CMD (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)**
   –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞—Å—Ç–æ—è—â–∏–π curl.exe (Windows 10+ —É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –µ–≥–æ).

2. **PowerShell**
   –ó–¥–µ—Å—å —á–∞—Å—Ç–æ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü–∞:
   PowerShell –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É curl –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –µ—ë –Ω–∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é Invoke-WebRequest, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã --resolve. –ß—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ —ç—Ç–æ, –Ω—É–∂–Ω–æ —è–≤–Ω–æ –≤—ã–∑–≤–∞—Ç—å –±–∏–Ω–∞—Ä–Ω–∏–∫:
   ```
   curl.exe -I --resolve fw-download.ubnt.com:443:VPS_IP https://fw-download.ubnt.com/
   ```

3. **WSL (Windows Subsystem for Linux)**
   –≠—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è Linux-—Å—Ä–µ–¥–∞ –≤–Ω—É—Ç—Ä–∏ Windows, —Ç–∞–º –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∂–µ, –∫–∞–∫ –Ω–∞ Ubuntu/Debian. –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ UniFi Network (–≤–µ—Ä—Å–∏—è 9.4.19)

### 3.1 –î–æ–±–∞–≤–ª—è–µ–º DNS-–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ Settings ‚Üí Advanced Features ‚Üí Policy Engine

2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Policy Table

3. –ù–∞–∂–º–∏—Ç–µ Create New Policy

   ‚Ä¢ DNS

   ‚Ä¢ Type: Host (A)

4. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–ø–∏—Å–∏:

<table>
    <tr>
        <td>Domain Name</td>
<td>IP Address</td>
    </tr>
<tr>
        <td>fw-update.ubnt.com</td>
<td>VPS_IP</td>
    </tr>
<tr>
        <td>fw-download.ubnt.com</td>
<td>VPS_IP</td>
    </tr>
<tr>
        <td>fw-update.ui.com</td>
<td>VPS_IP</td>
    </tr>
<tr>
        <td>apt.artifacts.ui.com</td>
<td>VPS_IP</td>
    </tr>
<tr>
        <td>apt-beta.artifacts.ui.com</td>
<td>VPS_IP</td>
    </tr>
<tr>
        <td>apt-release-candidate.artifacts.ui.com</td>
<td>VPS_IP</td>
    </tr>
</table>

### 3.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ UDM-Pro

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH –∫ —Å–≤–æ–µ–º—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—É:

> ‚ùó –û–±—Ä–∞—â–∞—é –≤–Ω–∏–º–∞–Ω–∏–µ, –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ SSH –∑–∞–º–µ–Ω–∏—Ç–µ UDM_IP –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ (–≤ –º–æ–µ–º —Å–ª—É—á–∞–µ UniFi Dream Machine PRO)

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: Unifi Firmware Proxy Gateway                                                                                                                         3


---



```
ssh root@UDM_IP
nslookup fw-download.ubnt.com
```

–û–∂–∏–¥–∞–µ–º:

```
Server: 127.0.0.1
Address: 127.0.0.1#53
Name: fw-download.ubnt.com
Address: VPS_IP
fw-download.ubnt.com canonical name = geo-block.errors.svc.ui.com.
```

CNAME –Ω–∞ geo-block –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è ‚Äî —ç—Ç–æ –Ω–µ –º–µ—à–∞–µ—Ç, A –∞–¥—Ä–µ—Å –ø–æ–¥–º–µ–Ω—ë–Ω.

### 3.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞

–ù–∞ VPS:

```
sudo tail -f /var/log/nginx/stream_access.log
```

–í—ã–≤–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:

```
WAN_IP:60366 ‚Üí fw-update.ubnt.com (TCP)
WAN_IP:60360 ‚Üí fw-update.ubnt.com (TCP)
WAN_IP:50655 ‚Üí fw-download.ubnt.com (TCP)
WAN_IP:34456 ‚Üí fw-update.ubnt.com (TCP)
WAN_IP:34454 ‚Üí fw-update.ubnt.com (TCP)
WAN_IP:34446 ‚Üí fw-update.ubnt.com (TCP)
```

–ù–∞ UDM-Pro:

```
curl -I https://fw-download.ubnt.com/
```

–í—ã–≤–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:

```
HTTP/2 403
x-amz-cf-pop: FRAxx
server: cloudflare
via: 1.1 cloudfront.net
```

–ï—Å–ª–∏ –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤–µ—Ä–Ω–æ ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UniFi OS, Protect, Network –∏ –¥—Ä. –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –≥–µ–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

> ‚ö†Ô∏è –î–æ —ç—Ç–æ–≥–æ —à–∞–≥–∞ –≤ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ –Ø –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –æ–ø—É—Å–∫–∞—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ñ–∞–π—Ä–≤–æ–ª–∞ –Ω–∞ –≤–∞—à–µ–π VPS, —Ç–∞–∫ –∫–∞–∫ –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é, —Å–æ —Å–≤–æ–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
> –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥—ë–Ω –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ iptables - –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ UFW –∏–ª–∏ –¥—Ä—É–≥–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç–µ–≤—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.

## 4. –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞:

### 4.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ iptables

–ë–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

> ‚ùó –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–µ–Ω–∏—Ç—å WAN_IP –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –≤–Ω–µ—à–Ω–∏–π IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ –∏–ª–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ UniFi –±—É–¥—É—Ç –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ VPS.

```
sudo iptables -I INPUT 1 -p tcp --dport 443 ! -s WAN_IP -j DROP
sudo iptables -A INPUT -p tcp -s WAN_IP --dport 443 -j ACCEPT
sudo iptables -A INPUT -p tcp -s WAN_IP --dport 22 -j ACCEPT
sudo iptables -A INPUT -m conntrack --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A INPUT -p icmp -j ACCEPT
```

–ü—Ä–æ–≤–µ—Ä–∏–º:

```
sudo iptables -L INPUT -n -v --line-numbers | sed -n '1,15p'
```

–í—ã–≤–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:

<table>
<thead>
<tr>
<th>Chain INPUT (policy ACCEPT X packets, X bytes)</th>
</tr>
</thead>
<tbody>
<tr>
<td>num</td>
<td>pkts</td>
<td>bytes</td>
<td>target</td>
<td>prot</td>
<td>opt</td>
<td>in</td>
<td>out</td>
<td>source</td>
<td>destination</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
<td>DROP</td>
<td>tcp</td>
<td>--</td>
<td>*</td>
<td>*</td>
<td>!WAN_IP</td>
<td>0.0.0.0/0 tcp dpt:443</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
<td>0</td>
<td>ACCEPT</td>
<td>tcp</td>
<td>--</td>
<td>*</td>
<td>*</td>
<td>WAN_IP</td>
<td>0.0.0.0/0 tcp dpt:443</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
<td>0</td>
<td>ACCEPT</td>
<td>tcp</td>
<td>--</td>
<td>*</td>
<td>*</td>
<td>WAN_IP</td>
<td>0.0.0.0/0 tcp dpt:22</td>
</tr>
<tr>
<td>4</td>
<td>0</td>
<td>0</td>
<td>ACCEPT</td>
<td>all</td>
<td>--</td>
<td>*</td>
<td>*</td>
<td>0.0.0.0/0</td>
<td>0.0.0.0/0 ctstate RELATED,ESTABLISHED</td>
</tr>
<tr>
<td>5</td>
<td>0</td>
<td>0</td>
<td>ACCEPT</td>
<td>icmp</td>
<td>--</td>
<td>*</td>
<td>*</td>
<td>0.0.0.0/0</td>
<td>0.0.0.0/0</td>
</tr>
</tbody>
</table>

### 4.2 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

```
sudo apt install -y iptables-persistent
sudo netfilter-persistent save
sudo netfilter-persistent reload
```

### 4.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: Unifi Firmware Proxy Gateway                                                                                                                       4


---



> ‚ùó –û–±—Ä–∞—â–∞—é –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤–º–µ—Å—Ç–æ VPS_IP –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–π VPS, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø—É—â–µ–Ω NGINX-–ø—Ä–æ–∫—Å–∏.

```
curl -I --resolve fw-download.ubnt.com:443:VPS_IP https://fw-download.ubnt.com/ | head -n1
```

–û–∂–∏–¥–∞–µ–º –æ—Ç–≤–µ—Ç HTTP/2 403 (–∏–ª–∏ 200/302 –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—É—Ç—è—Ö).

```
% Total  % Received % Xferd Average Speed Time  Time   Time  Current
                                 Dload Upload Total  Spent    Left  Speed
0     0    0     0    0     0      0      0 --:--:-- 0:00:01 --:--:--     0
```

```
HTTP/2 403
```

–ù–∞ VPS:

```
sudo tail -f /var/log/nginx/stream_access.log
```

```
WAN_IP:39210 ‚Üí fw-download.ubnt.com (TCP)
WAN_IP:39470 ‚Üí fw-download.ubnt.com (TCP)
WAN_IP:40328 ‚Üí fw-update.ubnt.com (TCP)
WAN_IP:40330 ‚Üí fw-update.ubnt.com (TCP)
WAN_IP:40306 ‚Üí fw-update.ubnt.com (TCP)
WAN_IP:41056 ‚Üí fw-download.ubnt.com (TCP)
WAN_IP:41686 ‚Üí fw-download.ubnt.com (TCP)
WAN_IP:43874 ‚Üí fw-update.ubnt.com (TCP)
WAN_IP:43872 ‚Üí fw-update.ubnt.com (TCP)
WAN_IP:43868 ‚Üí fw-update.ubnt.com (TCP)
```

–ù–∞–±–ª—é–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –í–∞—à IP –∏ fw-download/fw-update.

## 4.4 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ IP –¥–ª—è –¥–æ—Å—Ç—É–ø–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –¥–ª—è 2-–≥–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞, —Ç–µ—Å—Ç–æ–≤–æ–π –ø–ª–æ—â–∞–¥–∫–∏ –∏–ª–∏ –Ω–æ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏:

### 4.4.1 –î–æ–±–∞–≤–ª—è–µ–º –≤ iptables

> ‚ùó –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–µ–Ω–∏—Ç—å NEW_WAN_IP –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –≤–Ω–µ—à–Ω–∏–π IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ –∏–ª–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ UniFi –±—É–¥—É—Ç –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ VPS.

```
sudo iptables -I INPUT 2 -p tcp -s NEW_WAN_IP --dport 443 -j ACCEPT
sudo netfilter-persistent save
```

### 4.4.2 –î–æ–±–∞–≤–ª—è–µ–º –≤ nginx

–û—Ç–∫—Ä–æ–π `sudo mcedit /etc/nginx/stream.conf.d/ubnt-stream.conf` –∏ –¥–æ–±–∞–≤—å:

> ‚ùó –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–µ–Ω–∏—Ç—å NEW_WAN_IP –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –≤–Ω–µ—à–Ω–∏–π IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ –∏–ª–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ UniFi –±—É–¥—É—Ç –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ VPS.

```
allow WAN_IP; ‚Üê —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∑–∞–ø–∏—Å—å, –≤–Ω–µ—Å–µ–Ω–∞ —Ä–∞–Ω–µ–µ –Ω–∞ —à–∞–≥–µ 2.3
allow NEW_WAN_IP;
deny all;
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ NGINX:

```
sudo nginx -t && sudo systemctl reload nginx
```

### 4.4.3 –ü—Ä–æ–≤–µ—Ä–∫–∞

–°–º–æ—Ç—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç 4.3

# –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —à–ª—é–∑ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π UniFi.

–ß—Ç–æ –≤ –∏—Ç–æ–≥–µ:

1. –û–±–Ω–æ–≤–ª–µ–Ω–∏—è UniFi –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –≤–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π NGINX-–ø—Ä–æ–∫—Å–∏ –Ω–∞ VPS.

2. –ì–µ–æ–±–ª–æ–∫ geo-block.errors.svc.ui.com —É—Å–ø–µ—à–Ω–æ –æ–±–æ–π–¥—ë–Ω ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

3. –ü–æ—Ä—Ç 443 –Ω–∞ VPS –æ—Ç–∫—Ä—ã—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞—à–∏—Ö –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤, —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

4. –õ–æ–≥–∏ NGINX —Ñ–∏–∫—Å–∏—Ä—É—é—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤–∞—à–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å —Ç—Ä–∞—Ñ–∏–∫–∞.

5. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å–µ–≥–æ –¥–≤–µ –∫–æ–º–∞–Ω–¥—ã ‚Äî –±–µ–∑ –ø—Ä–∞–≤–æ–∫ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∫—Å–∏.

# –ú–∏–Ω—É—Å —Ä–µ—à–µ–Ω–∏—è

1. –ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞—Ä—É–±–µ–∂–Ω—ã–π VPS —Å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º IP-–∞–¥—Ä–µ—Å–æ–º, –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–ª–∞—á–∏–≤–∞—Ç—å –µ–∂–µ–º–µ—Å—è—á–Ω–æ.

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: Unifi Firmware Proxy Gateway                                                                                                        5
